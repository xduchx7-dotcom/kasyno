// --- KONFIGURACJA ---
const PLATNOSCI_FILE = 'platnosci.json'; // TwÃ³j plik z wpÅ‚atami
const ODÅšWIEÅ»ANIE_MS = 5000; // co ile ms odÅ›wieÅ¼amy dane
let gracze = [];
let sumaPuli = 0;
let licznik = 60; // sekundy do losowania

// --- ELEMENTY HTML ---
const listaGraczyEl = document.getElementById('lista-graczy');
const sumaPuliEl = document.getElementById('suma-puli');
const licznikEl = document.getElementById('licznik');
const losujBtn = document.getElementById('losuj');

// --- FUNKCJE ---
async function pobierzDane() {
    try {
        const response = await fetch(PLATNOSCI_FILE);
        if (!response.ok) throw new Error('Nie udaÅ‚o siÄ™ pobraÄ‡ danych');
        const dane = await response.json();
        gracze = dane;
        sumaPuli = gracze.reduce((acc, g) => acc + Number(g.kwota || 0), 0);
        aktualizujWidok();
    } catch (err) {
        console.error(err);
        // jeÅ›li bÅ‚Ä…d, moÅ¼na uÅ¼yÄ‡ pustej listy
        gracze = [];
        sumaPuli = 0;
        aktualizujWidok();
    }
}

function aktualizujWidok() {
    // Lista graczy
    listaGraczyEl.innerHTML = '';
    gracze.forEach(g => {
        const li = document.createElement('li');
        li.textContent = `${g.nick}: $${g.kwota}`;
        listaGraczyEl.appendChild(li);
    });
    // Suma puli
    sumaPuliEl.textContent = `Suma w puli: $${sumaPuli}`;
    // Licznik
    licznikEl.textContent = `NastÄ™pne losowanie za: ${licznik}s`;
}

function startLicznik() {
    setInterval(() => {
        licznik--;
        if (licznik <= 0) {
            licznik = 60; // reset licznika
            losuj();
        }
        aktualizujWidok();
    }, 1000);
}

function losuj() {
    if (gracze.length === 0) return alert('Brak graczy do losowania!');
    // Losowanie zwyciÄ™zcy
    const index = Math.floor(Math.random() * gracze.length);
    const zwyciezca = gracze[index];
    alert(`ðŸŽ‰ WygraÅ‚ ${zwyciezca.nick}! Kwota: $${zwyciezca.kwota}`);
    // reset puli i graczy po losowaniu
    gracze = [];
    sumaPuli = 0;
    aktualizujWidok();
}

// --- EVENTY ---
losujBtn.addEventListener('click', losuj);

// --- URUCHOMIENIE ---
pobierzDane(); // pierwsze pobranie
startLicznik(); // licznik
setInterval(pobierzDane, ODÅšWIEÅ»ANIE_MS); // odÅ›wieÅ¼anie co 5s
